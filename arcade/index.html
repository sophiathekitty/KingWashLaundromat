<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arcade Paradise - King Wash</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <div class="header-content">
            <!-- King Wash Pamphlet integrated into header - left side -->
            <div class="king-wash-container">
                <div class="king-wash-pamphlet">
                    <a href="../index.html" class="king-wash-card">
                        <div class="pamphlet-content">
                            <div class="pamphlet-header">
                                <img src="../img/logo-gold.png" alt="King Wash Logo" class="pamphlet-logo">
                                <h3>King Wash</h3>
                                <div class="luxury-accent"></div>
                            </div>
                            <div class="pamphlet-body">
                                <p class="tagline">Premium Laundromat</p>
                                <p class="description">Clean clothes, classic games</p>
                                <div class="luxury-border"></div>
                            </div>
                            <div class="pamphlet-footer">
                                <span class="cta">Visit Now ‚Üí</span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
            
            <div class="header-text">
                <h1>Arcade Paradise</h1>
                <p>What started as a simple laundromat has grown into a thriving retro arcade, thanks to our new manager's passion for game development! Step into the backroom and discover original creations alongside some incredible cabinets from other talented builders. Play hard, fold fast!</p>
            </div>
            
            <!-- Loyalty Rewards moved to header - right side -->
            <div class="header-loyalty">
                <div class="loyalty-scoreboard" id="loyalty-scoreboard">
                    <div class="loyalty-summary">
                        <div class="points-display">
                            <span class="points-icon">‚≠ê</span>
                            <span class="points-value" id="loyalty-points">0</span>
                            <span class="points-label">LP</span>
                        </div>
                        <div class="streak-display">
                            <span class="streak-icon">üî•</span>
                            <span class="streak-value" id="visit-streak">0</span>
                            <span class="streak-label">Streak</span>
                        </div>
                    </div>
                    <div class="loyalty-dropdown" id="loyalty-dropdown">
                        <h4>Recent Rewards</h4>
                        <div class="recent-rewards" id="recent-rewards">
                            <!-- Recent rewards will be populated here -->
                        </div>
                        <button class="daily-checkin-btn" id="header-daily-checkin">Daily Check-in</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Featured Cabinet & Promotions -->
    <section class="featured-section">
        <div class="featured-cabinet">
            <h2>Featured Cabinet</h2>
            <div class="featured-card" id="featured-card">
                <div class="featured-gallery">
                    <div class="hero-image-container">
                        <img src="img/woodgal-jr.png" alt="Featured Game" id="featured-hero-image" class="hero-image">
                        <div class="rare-badge" id="rare-badge" style="display: none;">
                            <span class="rare-text">RARE</span>
                            <div class="rare-sparkles"></div>
                        </div>
                    </div>
                    <div class="thumbnail-gallery" id="thumbnail-gallery">
                        <!-- Thumbnails will be populated by JavaScript -->
                    </div>
                </div>
                <div class="featured-info">
                    <h3 id="featured-title">Woodgal Jr.</h3>
                    <p id="featured-description">A fast-paced tree-chopping game. Swap sides to avoid branches!</p>
                    <button class="featured-button" id="featured-button" onclick="openSteam('https://steamcommunity.com/sharedfiles/filedetails/?id=3142471782')">
                        Play Now
                    </button>
                    <div class="credits-link">
                        <a href="credits.html" class="credits-button">
                            <span class="credits-icon">üìú</span>
                            View Credits & Resources
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="daily-specials">
            <h2>Daily Specials</h2>
            
            <!-- Dynamic Specials Container - matches featured cabinet height -->
            <div id="daily-specials-container">
                <!-- Specials will be generated by JavaScript -->
            </div>
        </div>
    </section>


    <section>
        <h2>Custom Arcade Cabinets</h2>
        <p>These one-of-a-kind games were designed and built in-house! Click a cabinet to learn more or download it from the Steam Workshop.</p>
        
        <div class="carousel-container">
            <button class="carousel-btn carousel-btn-prev" id="carousel-prev">‚Äπ</button>
            <div class="carousel-wrapper">
                <div class="arcade-carousel" id="arcade-carousel">
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3142471782">
                        <img src="img/woodgal-jr.png" alt="Woodgal Jr.">
                        <h3>Woodgal Jr.</h3>
                        <p>A fast-paced tree-chopping game. Swap sides to avoid branches!</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3142472800">
                        <img src="img/dance-engineer-dance.png" alt="Dance Engineer Dance">
                        <h3>Dance Engineer Dance</h3>
                        <p>Test your rhythm in this DDR-inspired cabinet!</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3142474001">
                        <img src="img/air-hockey.png" alt="Air Hockey">
                        <h3>Air Hockey</h3>
                        <p>Classic air hockey fun, now digital!</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3159105570">
                        <img src="img/flappy-bird.png" alt="Flappy Bird">
                        <h3>Flappy Bird</h3>
                        <p>Flap your way through obstacles in this challenging remake.</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3159106410">
                        <img src="img/space-invaders.png" alt="Space Invaders">
                        <h3>Space Invaders</h3>
                        <p>Defend Earth in this tribute to the arcade classic.</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3159107075">
                        <img src="img/breakout.png" alt="Breakout">
                        <h3>Breakout</h3>
                        <p>Smash bricks and score big in this timeless game.</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3173071227">
                        <img src="img/wolf-3d.png" alt="Wolf 3D">
                        <h3>Wolf 3D</h3>
                        <p>A retro 3D shooter. It's like Wolfenstein but voxelized!</p>
                    </div>
                </div>
            </div>
            <button class="carousel-btn carousel-btn-next" id="carousel-next">‚Ä∫</button>
        </div>
    </section>

    <section>
        <div class="community-section-card">
            <h2>Community Arcade Cabinets</h2>
            <div class="community-content">
                <p>We're proud to showcase some incredible cabinets from the Steam Workshop that helped inspire our designs. These creations are a testament to the creativity of the Space Engineers community!</p>
        <div class="arcade-gallery">
            <div class="arcade-group" data-creator="kelevra">
                <div class="community-image" style="background-image: url('img/kelevra-tetris-snake.png')"></div>
                <h3>Kelevra</h3>
                <p>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2883502340" target="_blank" data-cabinet="tetris">Tetris</a> | 
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2906631630" target="_blank" data-cabinet="snake">Snake</a>
                </p>
            </div>
            <div class="arcade-group" data-creator="jasba">
                <div class="community-image" style="background-image: url('img/jasba-titan-flug.png')"></div>
                <h3>Jasba</h3>
                <p><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3048874542" target="_blank" data-cabinet="titan-flug">Titan Flug</a></p>
            </div>
            <div class="arcade-group" data-creator="avaness">
                <div class="community-image" style="background-image: url('img/avaness-cabinets.png')"></div>
                <h3>Avaness</h3>
                <p>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2432952109" target="_blank" data-cabinet="tron">Tron</a> | 
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2432951311" target="_blank" data-cabinet="avaness-snake">Snake</a> | 
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2432950269" target="_blank" data-cabinet="pong">Pong</a>
                </p>
            </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Arcade Gallery Section -->
    <section class="arcade-gallery-section">
        <h2>Arcade Gallery</h2>
        <p>Take a look behind the scenes at our arcade space and entrance area!</p>
        
        <div class="arcade-photos" id="arcade-photos">
            <!-- Photos will be randomly populated by JavaScript -->
        </div>
    </section>

    <footer>
        <p>&copy; 2077 Arcade Paradise. Powered by <span class="glitch-text" id="company-name">Grindstone Enterprises</span>.</p>
    </footer>

    <script>
        // Arcade cabinet data with image galleries
        const arcadeCabinets = [
            {
                title: "Woodgal Jr.",
                description: "A fast-paced tree-chopping game. Swap sides to avoid branches!",
                image: "img/woodgal-jr.png",
                thumbnails: ["img/woodgal-jr-1.png", "img/woodgal-jr-2.png", "img/woodgal-jr-3.png"],
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3142471782",
                rare: false
            },
            {
                title: "Dance Engineer Dance",
                description: "Test your rhythm in this DDR-inspired cabinet!",
                image: "img/dance-engineer-dance.png",
                thumbnails: ["img/dance-engineer-dance-1.png", "img/dance-engineer-dance-2.png", "img/dance-engineer-dance-3.png"],
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3142472800",
                rare: false
            },
            {
                title: "Air Hockey",
                description: "Classic air hockey fun, now digital!",
                image: "img/air-hockey.png",
                thumbnails: ["img/air-hockey-1.png", "img/air-hockey-2.png", "img/air-hockey-3.png"],
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3142474001",
                rare: false
            },
            {
                title: "Flappy Bird",
                description: "Flap your way through obstacles in this challenging remake.",
                image: "img/flappy-bird.png",
                thumbnails: ["img/flappy-bird-1.png", "img/flappy-bird-2.png", "img/flappy-bird-3.png"],
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3159105570",
                rare: false
            },
            {
                title: "Space Invaders",
                description: "Defend Earth in this tribute to the arcade classic.",
                image: "img/space-invaders.png",
                thumbnails: ["img/space-invaders-1.png", "img/space-invaders-2.png", "img/space-invaders-3.png"],
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3159106410",
                rare: false
            },
            {
                title: "Breakout",
                description: "Smash bricks and score big in this timeless game.",
                image: "img/breakout.png",
                thumbnails: ["img/breakout-1.png", "img/breakout-2.png", "img/breakout-3.png"],
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3159107075",
                rare: false
            },
            {
                title: "Wolf 3D",
                description: "A retro 3D shooter. It's like Wolfenstein but voxelized!",
                image: "img/wolf-3d.png",
                thumbnails: ["img/wolf-3d-1.png", "img/wolf-3d-2.png", "img/wolf-3d-3.png"],
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3173071227",
                rare: false
            },
            {
                title: "Bike Racer",
                description: "An experimental racing cabinet with a physical tilting bike controller. Drive down the road, lean to turn, and try to stay on track! Features other AI bikes but no collision or scoring - this prototype focuses on the unique controller experience.",
                image: "img/bike-racer.png",
                thumbnails: ["img/bike-racer-1.png", "img/bike-racer-2.png", "img/bike-racer-3.png"],
                steamUrl: null, // No Steam URL for rare prototype
                rare: true
            }
        ];

        // Carousel functionality
        class ArcadeCarousel {
            constructor() {
                this.carousel = document.getElementById('arcade-carousel');
                this.prevBtn = document.getElementById('carousel-prev');
                this.nextBtn = document.getElementById('carousel-next');
                this.originalCards = Array.from(this.carousel.querySelectorAll('.arcade-card'));
                this.currentIndex = 0;
                this.visibleCards = this.getVisibleCards();
                this.isAutoScrolling = true;
                this.autoScrollInterval = null;
                this.userInteractionTimeout = null;
                this.isTransitioning = false;
                this.isMobile = this.detectMobile();
                
                this.init();
            }
            
            detectMobile() {
                // Detect mobile devices
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                const isMobileUA = /android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(userAgent);
                const isMobileScreen = window.innerWidth <= 768;
                const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                
                return isMobileUA || (isMobileScreen && isTouchDevice);
            }
            
            getVisibleCards() {
                const width = window.innerWidth;
                if (width <= 480) return 1;
                if (width <= 768) return 2;
                if (width <= 1024) return 3;
                if (width <= 1440) return 4;
                return 5;
            }
            
            init() {
                if (this.isMobile) {
                    this.setupMobileCarousel();
                } else {
                    this.setupInfiniteScroll();
                    this.updateCarousel();
                    this.startAutoScroll();
                }
                
                this.setupEventListeners();
                this.updateClickHandlers();
            }
            
            setupMobileCarousel() {
                // Add mobile classes to disable transitions and enable static scrolling
                document.body.classList.add('mobile-no-transitions');
                this.carousel.closest('.carousel-container').classList.add('mobile-static-carousel');
                
                // Reset carousel to show original cards only
                this.carousel.innerHTML = '';
                this.originalCards.forEach(card => {
                    this.carousel.appendChild(card);
                });
                
                this.cards = Array.from(this.carousel.querySelectorAll('.arcade-card'));
                
                // Disable auto-scroll on mobile
                this.isAutoScrolling = false;
            }
            
            setupInfiniteScroll() {
                // Clear existing cards
                this.carousel.innerHTML = '';
                
                // Create enough clones for smooth infinite scrolling
                const totalNeeded = this.originalCards.length * 3; // Show original + clones before and after
                
                // Add clones before original
                for (let i = 0; i < this.originalCards.length; i++) {
                    const clone = this.originalCards[i].cloneNode(true);
                    clone.classList.add('carousel-clone');
                    this.carousel.appendChild(clone);
                }
                
                // Add original cards
                this.originalCards.forEach(card => {
                    this.carousel.appendChild(card);
                });
                
                // Add clones after original
                for (let i = 0; i < this.originalCards.length; i++) {
                    const clone = this.originalCards[i].cloneNode(true);
                    clone.classList.add('carousel-clone');
                    this.carousel.appendChild(clone);
                }
                
                // Update cards reference
                this.cards = Array.from(this.carousel.querySelectorAll('.arcade-card'));
                
                // Set initial position to show original cards
                this.currentIndex = this.originalCards.length;
                this.carousel.style.transition = 'none';
                this.updateCarousel();
                
                // Re-enable transitions after initial positioning
                setTimeout(() => {
                    this.carousel.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                }, 50);
            }
            
            updateClickHandlers() {
                this.cards.forEach(card => {
                    card.addEventListener('click', () => {
                        const steamUrl = card.getAttribute('data-steam-url');
                        if (steamUrl) {
                            window.open(steamUrl, '_blank');
                        }
                    });
                });
            }
            
            setupEventListeners() {
                if (this.isMobile) {
                    // Simplified mobile event listeners
                    this.carousel.addEventListener('mouseenter', () => this.handleUserInteraction());
                    this.carousel.addEventListener('mouseleave', () => this.resumeAutoScroll());
                    
                    // Touch events for mobile (but no auto-scroll)
                    this.carousel.addEventListener('touchstart', () => this.handleUserInteraction());
                    
                    return;
                }
                
                // Desktop event listeners with full functionality
                this.prevBtn.addEventListener('click', () => this.prevSlide());
                this.nextBtn.addEventListener('click', () => this.nextSlide());
                
                // Touch/drag support for desktop
                let startX = 0;
                let isDragging = false;
                
                this.carousel.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    isDragging = true;
                    this.handleUserInteraction();
                });
                
                this.carousel.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                });
                
                this.carousel.addEventListener('touchend', (e) => {
                    if (!isDragging) return;
                    isDragging = false;
                    
                    const endX = e.changedTouches[0].clientX;
                    const diffX = startX - endX;
                    
                    if (Math.abs(diffX) > 50) {
                        if (diffX > 0) {
                            this.nextSlide();
                        } else {
                            this.prevSlide();
                        }
                    }
                });
                
                // Mouse events
                this.carousel.addEventListener('mouseenter', () => this.handleUserInteraction());
                this.carousel.addEventListener('mouseleave', () => this.resumeAutoScroll());
                
                // Resize handler
                window.addEventListener('resize', () => {
                    this.visibleCards = this.getVisibleCards();
                    this.setupInfiniteScroll();
                });
            }
            
            nextSlide() {
                if (this.isMobile || this.isTransitioning) return;
                this.isTransitioning = true;
                
                this.currentIndex++;
                this.updateCarousel();
                this.handleUserInteraction();
                
                // Check if we need to reset position (infinite scroll)
                if (this.currentIndex >= this.originalCards.length * 2) {
                    setTimeout(() => {
                        this.carousel.style.transition = 'none';
                        this.currentIndex = this.originalCards.length;
                        this.updateCarousel();
                        setTimeout(() => {
                            this.carousel.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                            this.isTransitioning = false;
                        }, 50);
                    }, 500);
                } else {
                    setTimeout(() => {
                        this.isTransitioning = false;
                    }, 500);
                }
            }
            
            prevSlide() {
                if (this.isMobile || this.isTransitioning) return;
                this.isTransitioning = true;
                
                this.currentIndex--;
                this.updateCarousel();
                this.handleUserInteraction();
                
                // Check if we need to reset position (infinite scroll)
                if (this.currentIndex < 0) {
                    setTimeout(() => {
                        this.carousel.style.transition = 'none';
                        this.currentIndex = this.originalCards.length - 1;
                        this.updateCarousel();
                        setTimeout(() => {
                            this.carousel.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                            this.isTransitioning = false;
                        }, 50);
                    }, 500);
                } else {
                    setTimeout(() => {
                        this.isTransitioning = false;
                    }, 500);
                }
            }
            
            updateCarousel() {
                if (this.isMobile || this.cards.length === 0) return;
                const cardWidth = this.cards[0].offsetWidth + 24; // Include gap
                const offset = -this.currentIndex * cardWidth;
                this.carousel.style.transform = `translateX(${offset}px)`;
            }
            
            handleUserInteraction() {
                if (this.isMobile) return; // No auto-scroll on mobile
                
                this.isAutoScrolling = false;
                clearInterval(this.autoScrollInterval);
                clearTimeout(this.userInteractionTimeout);
                
                this.userInteractionTimeout = setTimeout(() => {
                    this.resumeAutoScroll();
                }, 5000);
            }
            
            resumeAutoScroll() {
                if (this.isMobile) return; // No auto-scroll on mobile
                
                clearTimeout(this.userInteractionTimeout);
                this.startAutoScroll();
            }
            
            startAutoScroll() {
                if (this.isMobile) return; // No auto-scroll on mobile
                
                this.isAutoScrolling = true;
                this.autoScrollInterval = setInterval(() => {
                    if (this.isAutoScrolling) {
                        this.nextSlide();
                    }
                }, 3000);
            }
        }

        // Featured cabinet functionality with image gallery
        class FeaturedCabinet {
            constructor() {
                this.currentIndex = Math.floor(Math.random() * arcadeCabinets.length);
                this.currentImageIndex = 0;
                this.rotationInterval = null;
                this.imageRotationInterval = null;
                this.isUserActive = true;
                this.inactivityTimeout = null;
                this.imageInactivityTimeout = null;
                
                this.init();
            }
            
            init() {
                this.updateFeaturedCabinet();
                this.startInactivityTimer();
                
                // Track user activity
                document.addEventListener('mousemove', () => this.handleUserActivity());
                document.addEventListener('keydown', () => this.handleUserActivity());
                document.addEventListener('scroll', () => this.handleUserActivity());
                document.addEventListener('touchstart', () => this.handleUserActivity());
            }
            
            updateFeaturedCabinet() {
                const cabinet = arcadeCabinets[this.currentIndex];
                this.currentImageIndex = 0; // Reset to first image
                
                // Create array of all images for this cabinet
                this.allImages = [cabinet.image, ...(cabinet.thumbnails || [])];
                
                // Update hero image
                this.updateHeroImage();
                
                // Update info
                document.getElementById('featured-title').textContent = cabinet.title;
                document.getElementById('featured-description').textContent = cabinet.description;
                
                // Update button
                const button = document.getElementById('featured-button');
                if (cabinet.steamUrl) {
                    button.textContent = 'Play Now';
                    button.onclick = () => openSteam(cabinet.steamUrl);
                    button.style.display = 'block';
                    button.style.opacity = '1';
                    button.style.cursor = 'pointer';
                } else {
                    button.textContent = 'Prototype Only';
                    button.onclick = null;
                    button.style.opacity = '0.6';
                    button.style.cursor = 'not-allowed';
                }
                
                // Show/hide rare badge
                const rareBadge = document.getElementById('rare-badge');
                if (cabinet.rare) {
                    rareBadge.style.display = 'block';
                    this.animateRareBadge();
                } else {
                    rareBadge.style.display = 'none';
                }
                
                // Update thumbnail gallery
                this.updateThumbnailGallery();
                
                // Start image auto-cycling
                this.startImageCycling();
            }
            
            updateHeroImage() {
                const cabinet = arcadeCabinets[this.currentIndex];
                const heroImage = document.getElementById('featured-hero-image');
                const currentImageSrc = this.allImages[this.currentImageIndex];
                
                // Fade out
                heroImage.style.opacity = '0.7';
                
                setTimeout(() => {
                    heroImage.src = currentImageSrc;
                    heroImage.alt = `${cabinet.title} - Image ${this.currentImageIndex + 1}`;
                    
                    // Fade in
                    heroImage.style.opacity = '1';
                }, 200);
            }
            
            updateThumbnailGallery() {
                const cabinet = arcadeCabinets[this.currentIndex];
                const thumbnailGallery = document.getElementById('thumbnail-gallery');
                thumbnailGallery.innerHTML = '';
                
                // Add all images as thumbnails
                this.allImages.forEach((imageSrc, index) => {
                    const thumb = this.createThumbnail(imageSrc, `${cabinet.title} view ${index + 1}`, index === this.currentImageIndex);
                    thumb.setAttribute('data-image-index', index);
                    thumbnailGallery.appendChild(thumb);
                });
            }
            
            createThumbnail(src, alt, isActive = false) {
                const thumb = document.createElement('div');
                thumb.className = `thumbnail ${isActive ? 'active' : ''}`;
                
                const img = document.createElement('img');
                img.src = src;
                img.alt = alt;
                
                thumb.appendChild(img);
                
                // Add click handler to select this image
                thumb.addEventListener('click', () => {
                    const imageIndex = parseInt(thumb.getAttribute('data-image-index'));
                    this.selectImage(imageIndex);
                    this.handleUserActivity(); // Reset inactivity timer
                    this.handleImageInteraction(); // Reset image cycling timer
                });
                
                return thumb;
            }
            
            selectImage(imageIndex) {
                if (imageIndex !== this.currentImageIndex) {
                    this.currentImageIndex = imageIndex;
                    this.updateHeroImage();
                    this.setActiveThumbnail(imageIndex);
                }
            }
            
            setActiveThumbnail(activeIndex) {
                // Remove active class from all thumbnails
                document.querySelectorAll('.thumbnail').forEach((thumb, index) => {
                    thumb.classList.toggle('active', index === activeIndex);
                });
            }
            
            cycleToNextImage() {
                if (this.allImages.length > 1) {
                    this.currentImageIndex = (this.currentImageIndex + 1) % this.allImages.length;
                    this.updateHeroImage();
                    this.setActiveThumbnail(this.currentImageIndex);
                }
            }
            
            startImageCycling() {
                this.stopImageCycling();
                
                // Only start cycling if there are multiple images
                if (this.allImages.length > 1) {
                    this.imageInactivityTimeout = setTimeout(() => {
                        this.imageRotationInterval = setInterval(() => {
                            this.cycleToNextImage();
                        }, 3000); // Cycle every 3 seconds
                    }, 60000); // Start cycling after 1 minute of inactivity
                }
            }
            
            stopImageCycling() {
                clearTimeout(this.imageInactivityTimeout);
                clearInterval(this.imageRotationInterval);
            }
            
            handleImageInteraction() {
                this.stopImageCycling();
                this.startImageCycling();
            }
            
            animateRareBadge() {
                const badge = document.getElementById('rare-badge');
                const sparkles = badge.querySelector('.rare-sparkles');
                
                // Animate sparkles
                sparkles.innerHTML = '';
                for (let i = 0; i < 6; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.animationDelay = `${Math.random() * 2}s`;
                    sparkles.appendChild(sparkle);
                }
            }
            
            rotateFeatured() {
                this.currentIndex = (this.currentIndex + 1) % arcadeCabinets.length;
                this.updateFeaturedCabinet();
            }
            
            handleUserActivity() {
                this.isUserActive = true;
                clearTimeout(this.inactivityTimeout);
                clearInterval(this.rotationInterval);
                this.startInactivityTimer();
            }
            
            startInactivityTimer() {
                this.inactivityTimeout = setTimeout(() => {
                    this.isUserActive = false;
                    this.startRotation();
                }, 30000); // 30 seconds of inactivity
            }
            
            startRotation() {
                if (!this.isUserActive) {
                    this.rotationInterval = setInterval(() => {
                        if (!this.isUserActive) {
                            this.rotateFeatured();
                        }
                    }, 10000); // Rotate every 10 seconds when inactive
                }
            }
        }

        // Auto-cycling gallery animation (for community section)
        let isUserInteracting = false;
        let cycleTimeout;
        
        function startAutoCycle() {
            if (!isUserInteracting) {
                const galleries = document.querySelectorAll('.arcade-gallery');
                galleries.forEach(gallery => {
                    gallery.classList.add('auto-cycle');
                });
            }
        }
        
        function stopAutoCycle() {
            const galleries = document.querySelectorAll('.arcade-gallery');
            galleries.forEach(gallery => {
                gallery.classList.remove('auto-cycle');
            });
        }
        
        // Stop auto-cycle when user interacts
        function handleUserInteraction() {
            isUserInteracting = true;
            stopAutoCycle();
            clearTimeout(cycleTimeout);
            
            // Resume auto-cycle after 10 seconds of no interaction
            cycleTimeout = setTimeout(() => {
                isUserInteracting = false;
                startAutoCycle();
            }, 10000);
        }
        
        // Event listeners for user interaction
        document.addEventListener('scroll', handleUserInteraction);
        document.addEventListener('mousemove', handleUserInteraction);
        document.addEventListener('touchstart', handleUserInteraction);
        
        // Add hover events to arcade cards (including community cards)
        document.querySelectorAll('.arcade-card, .arcade-group').forEach(card => {
            card.addEventListener('mouseenter', handleUserInteraction);
        });
        
        // Community card zoom effects
        document.querySelectorAll('.arcade-group a[data-cabinet]').forEach(link => {
            const parentGroup = link.closest('.arcade-group');
            const cabinetType = link.getAttribute('data-cabinet');
            
            link.addEventListener('mouseenter', function() {
                parentGroup.classList.add(`zoom-${cabinetType}`, 'zooming');
                handleUserInteraction();
            });
            
            link.addEventListener('mouseleave', function() {
                parentGroup.classList.remove(`zoom-${cabinetType}`, 'zooming');
            });
        });
        
        // Start auto-cycle when page loads
        window.addEventListener('load', () => {
            setTimeout(startAutoCycle, 2000);
        });
        
        // Glitch effect for company name
        const companyName = document.getElementById('company-name');
        let isGlitched = false;
        
        companyName.addEventListener('mouseenter', function() {
            if (!isGlitched) {
                this.classList.add('glitching');
                
                setTimeout(() => {
                    this.textContent = 'Null Systems';
                    this.style.color = '#ff00d9';
                    this.classList.remove('glitching');
                    isGlitched = true;
                    
                    // Make it a link
                    const link = document.createElement('a');
                    link.href = 'https://sophiathekitty.github.io/GridDB/index.html';
                    link.target = '_blank';
                    link.className = 'glitch-text';
                    link.style.color = '#ff00d9';
                    link.style.textDecoration = 'none';
                    link.textContent = 'Null Systems';
                    
                    this.parentNode.replaceChild(link, this);
                }, 500);
            }
        });
        
        companyName.addEventListener('touchstart', function() {
            // Same functionality for mobile
            if (!isGlitched) {
                this.classList.add('glitching');
                
                setTimeout(() => {
                    this.textContent = 'Null Systems';
                    this.style.color = '#ff00d9';
                    this.classList.remove('glitching');
                    isGlitched = true;
                    
                    const span = document.createElement('span');
                    span.className = 'glitch-text';
                    span.style.color = '#ff00d9';
                    span.style.cursor = 'pointer';
                    span.textContent = 'Null Systems';
                    span.onclick = () => alert('Access Denied - System Offline');
                    
                    this.parentNode.replaceChild(span, this);
                }, 500);
            }
        });

        function openSteam(url) {
            window.open(url, '_blank');
        }

        // Loyalty Points System
        class LoyaltySystem {
            constructor() {
                this.storageKey = 'kingwash_loyalty';
                this.data = this.loadData();
                this.recentRewards = [];
                this.dailyDeals = [
                    {id: 'welcome_premium', title: 'üéâ Welcome Premium Bonus', desc: 'First-time visitor special offer', reward: 125, price: 'Extra 20% off everything (Save ~95 SC)', isWelcome: true},
                    {id: 'arcade_combo', title: 'üéÆ Arcade + Laundry Combo', desc: 'Play 3 games while washing', reward: 75, price: '15% off laundry (Save ~45 SC)'},
                    {id: 'high_score', title: 'üèÜ High Score Challenge', desc: 'Beat today\'s high score on any cabinet', reward: 100, price: 'Free soap tokens (Worth 25 SC)'},
                    {id: 'social_share', title: 'üì± Share the Fun', desc: 'Tell a friend about King Wash Arcade', reward: 50, price: 'Word-of-mouth bonus'},
                    {id: 'wash_cycle', title: 'üåÄ Full Service Wash', desc: 'Use wash, dry, and fold services', reward: 120, price: 'Premium service discount (Save ~80 SC)'},
                    {id: 'loyalty_member', title: '‚≠ê VIP Treatment', desc: 'Spend over 500 SC in one visit', reward: 200, price: 'Big spender bonus'},
                    {id: 'early_bird', title: 'üåÖ Early Bird Special', desc: 'Visit before 9 AM', reward: 60, price: 'Off-peak pricing (Save ~30 SC)'},
                    {id: 'night_owl', title: 'ü¶â Night Owl Bonus', desc: 'Visit after 10 PM', reward: 80, price: 'Late night discount (Save ~40 SC)'},
                    {id: 'weekend_warrior', title: 'üéØ Weekend Warrior', desc: 'Complete 5 arcade challenges', reward: 150, price: 'Weekend entertainment package'}
                ];
                
                this.init();
            }
            
            loadData() {
                const saved = localStorage.getItem(this.storageKey);
                if (saved) {
                    const data = JSON.parse(saved);
                    this.recentRewards = data.recentRewards || [];
                    return data;
                }
                return {
                    points: 0,
                    streak: 0,
                    lastVisit: null,
                    welcomeClaimed: false,
                    todaysClaims: {},
                    yesterdaysClaims: {},
                    dailyDealsGenerated: null,
                    recentRewards: []
                };
            }
            
            saveData() {
                this.data.recentRewards = this.recentRewards;
                localStorage.setItem(this.storageKey, JSON.stringify(this.data));
            }
            
            init() {
                this.updateDisplay();
                this.checkDailyReset();
                this.generateDailySpecials();
                this.setupEventListeners();
                this.updateRecentRewards();
            }
            
            checkDailyReset() {
                const today = new Date().toDateString();
                const lastVisit = this.data.lastVisit;
                
                if (lastVisit !== today) {
                    // Move today's claims to yesterday's
                    this.data.yesterdaysClaims = {...this.data.todaysClaims};
                    this.data.todaysClaims = {};
                    
                    // Update streak
                    if (lastVisit) {
                        const lastDate = new Date(lastVisit);
                        const todayDate = new Date(today);
                        const diffTime = Math.abs(todayDate - lastDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        if (diffDays === 1) {
                            this.data.streak += 1;
                        } else if (diffDays > 1) {
                            this.data.streak = 1;
                        }
                    } else {
                        this.data.streak = 1;
                    }
                    
                    this.data.lastVisit = today;
                    this.data.dailyDealsGenerated = null;
                    this.saveData();
                }
            }
            
            generateDailySpecials() {
                const container = document.getElementById('daily-specials-container');
                const specials = [];
                
                // Priority 1: Welcome bonus (if not claimed)
                if (!this.data.welcomeClaimed) {
                    const welcomeDeal = this.dailyDeals.find(d => d.isWelcome);
                    specials.push({...welcomeDeal, type: 'welcome'});
                }
                
                // Priority 2: Yesterday's bonuses (if any)
                Object.entries(this.data.yesterdaysClaims).forEach(([dealId, claimed]) => {
                    if (claimed && specials.length < 4) {
                        const deal = this.dailyDeals.find(d => d.id === dealId);
                        if (deal) {
                            specials.push({
                                ...deal,
                                id: dealId + '_bonus',
                                title: `‚è∞ ${deal.title} - Completion Bonus`,
                                desc: 'Extra points for completing yesterday\'s challenge!',
                                reward: Math.floor(deal.reward * 0.5),
                                type: 'yesterday'
                            });
                        }
                    }
                });
                
                // Priority 3: Fill remaining slots with daily deals
                const today = new Date().toDateString();
                if (this.data.dailyDealsGenerated !== today) {
                    this.data.dailyDealsGenerated = today;
                    this.saveData();
                }
                
                const seed = this.hashCode(today);
                const availableDeals = this.dailyDeals.filter(d => !d.isWelcome);
                const shuffled = this.seededShuffle([...availableDeals], seed);
                
                while (specials.length < 4 && shuffled.length > 0) {
                    const deal = shuffled.shift();
                    specials.push({...deal, type: 'daily'});
                }
                
                this.renderSpecials(container, specials);
            }
            
            renderSpecials(container, specials) {
                container.innerHTML = '';
                
                specials.forEach(special => {
                    const claimed = this.data.todaysClaims[special.id] || 
                                  (special.type === 'welcome' && this.data.welcomeClaimed);
                    
                    const card = document.createElement('div');
                    card.className = `promo-card special-deal ${claimed ? 'claimed' : ''} ${special.type}-deal`;
                    card.dataset.dealId = special.id;
                    card.dataset.points = special.reward;
                    card.dataset.type = special.type;
                    
                    card.innerHTML = `
                        <h3>${special.title}</h3>
                        <p>${special.desc}</p>
                        <div class="promo-reward">+${special.reward} LP</div>
                        <div class="deal-value">üí∞ ${special.price}</div>
                        <div class="promo-badge ${claimed ? 'claimed' : 'claimable'}">${claimed ? 'Claimed' : 'Claim'}</div>
                    `;
                    
                    container.appendChild(card);
                });
            }
            
            setupEventListeners() {
                // Header loyalty scoreboard interaction
                const scoreboard = document.getElementById('loyalty-scoreboard');
                const dropdown = document.getElementById('loyalty-dropdown');
                
                scoreboard.addEventListener('mouseenter', () => {
                    scoreboard.classList.add('active');
                });
                
                scoreboard.addEventListener('mouseleave', () => {
                    scoreboard.classList.remove('active');
                });
                
                scoreboard.addEventListener('click', () => {
                    scoreboard.classList.toggle('active');
                });
                
                // Header daily check-in
                const headerCheckin = document.getElementById('header-daily-checkin');
                if (!this.data.todaysClaims['daily_checkin']) {
                    headerCheckin.addEventListener('click', () => this.claimDailyCheckin());
                } else {
                    headerCheckin.textContent = 'Checked In';
                    headerCheckin.disabled = true;
                }
                
                // Daily specials (delegated event listener)
                document.addEventListener('click', (e) => {
                    const card = e.target.closest('.special-deal');
                    if (card && !card.classList.contains('claimed')) {
                        this.claimSpecial(card);
                    }
                });
            }
            
            claimDailyCheckin() {
                const basePoints = 50;
                const streakBonus = Math.min(this.data.streak * 5, 50); // Max 50 bonus
                const totalPoints = basePoints + streakBonus;
                
                this.addPoints(totalPoints, document.getElementById('header-daily-checkin'));
                this.addRecentReward('Daily Check-in', totalPoints);
                
                this.data.todaysClaims['daily_checkin'] = true;
                
                const btn = document.getElementById('header-daily-checkin');
                btn.textContent = 'Checked In';
                btn.disabled = true;
                
                this.saveData();
            }
            
            claimSpecial(element) {
                const dealId = element.dataset.dealId;
                const points = parseInt(element.dataset.points);
                const type = element.dataset.type;
                const title = element.querySelector('h3').textContent;
                
                this.addPoints(points, element);
                this.addRecentReward(title, points);
                
                if (type === 'welcome') {
                    this.data.welcomeClaimed = true;
                } else if (type === 'yesterday') {
                    // Remove from yesterday's claims and regenerate specials
                    const originalId = dealId.replace('_bonus', '');
                    delete this.data.yesterdaysClaims[originalId];
                    setTimeout(() => this.generateDailySpecials(), 1000);
                } else {
                    this.data.todaysClaims[dealId] = true;
                }
                
                element.classList.add('claimed');
                element.querySelector('.promo-badge').textContent = 'Claimed';
                element.querySelector('.promo-badge').className = 'promo-badge claimed';
                
                this.saveData();
            }
            
            addRecentReward(name, points) {
                this.recentRewards.unshift({
                    name: name.replace(/[üéâüéÆüèÜüì±üåÄ‚≠êüåÖü¶âüéØ‚è∞]/g, '').trim(),
                    points: points,
                    date: new Date().toLocaleDateString()
                });
                
                // Keep only last 5 rewards
                this.recentRewards = this.recentRewards.slice(0, 5);
                this.updateRecentRewards();
            }
            
            updateRecentRewards() {
                const container = document.getElementById('recent-rewards');
                container.innerHTML = '';
                
                if (this.recentRewards.length === 0) {
                    container.innerHTML = '<div class="reward-item"><span class="reward-name">No recent rewards</span></div>';
                    return;
                }
                
                this.recentRewards.forEach(reward => {
                    const item = document.createElement('div');
                    item.className = 'reward-item';
                    item.innerHTML = `
                        <span class="reward-name">${reward.name}</span>
                        <span class="reward-points">+${reward.points} LP</span>
                    `;
                    container.appendChild(item);
                });
            }
            
            
            hashCode(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash);
            }
            
            seededShuffle(array, seed) {
                const rng = () => {
                    seed = seed * 9301 + 49297;
                    return (seed % 233280) / 233280;
                };
                
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(rng() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            addPoints(amount, element) {
                this.data.points += amount;
                this.updateDisplay();
                this.createArcadeEffects(element, amount);
            }
            
            createArcadeEffects(element, points) {
                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                // Create laser effects
                for (let i = 0; i < 6; i++) {
                    setTimeout(() => {
                        this.createLaser(centerX + (Math.random() - 0.5) * 200, centerY);
                    }, i * 100);
                }
                
                // Create explosion effect
                setTimeout(() => {
                    this.createExplosion(centerX, centerY);
                    this.createPointsPopup(centerX, centerY, points);
                }, 300);
                
                // Screen flash effect
                this.createScreenFlash();
            }
            
            createLaser(x, y) {
                const laser = document.createElement('div');
                laser.className = 'laser-effect';
                laser.style.left = x + 'px';
                laser.style.top = y + 'px';
                laser.style.animation = 'laserShoot 0.5s ease-out forwards';
                document.body.appendChild(laser);
                
                setTimeout(() => laser.remove(), 500);
            }
            
            createExplosion(x, y) {
                const explosion = document.createElement('div');
                explosion.className = 'explosion-effect';
                explosion.style.left = (x - 50) + 'px';
                explosion.style.top = (y - 50) + 'px';
                explosion.style.background = `
                    radial-gradient(circle, transparent 20%, var(--neon-pink) 25%, transparent 30%),
                    radial-gradient(circle, transparent 40%, var(--neon-cyan) 45%, transparent 50%),
                    conic-gradient(from 0deg, var(--neon-pink), var(--neon-cyan), var(--neon-pink))
                `;
                explosion.style.animation = 'neonExplode 1s ease-out forwards';
                document.body.appendChild(explosion);
                
                setTimeout(() => explosion.remove(), 1000);
            }
            
            createPointsPopup(x, y, points) {
                const popup = document.createElement('div');
                popup.className = 'points-popup';
                popup.textContent = `+${points} LP`;
                popup.style.left = (x - 30) + 'px';
                popup.style.top = (y - 20) + 'px';
                document.body.appendChild(popup);
                
                setTimeout(() => popup.remove(), 2000);
            }
            
            createScreenFlash() {
                const flash = document.createElement('div');
                flash.style.position = 'fixed';
                flash.style.top = '0';
                flash.style.left = '0';
                flash.style.width = '100vw';
                flash.style.height = '100vh';
                flash.style.background = 'rgba(0, 255, 255, 0.1)';
                flash.style.pointerEvents = 'none';
                flash.style.zIndex = '9999';
                flash.style.animation = 'screenFlash 0.3s ease-out';
                document.body.appendChild(flash);
                
                setTimeout(() => flash.remove(), 300);
            }
            
            updateDisplay() {
                // Update both header displays (there are two loyalty-points elements now)
                document.querySelectorAll('#loyalty-points').forEach(el => {
                    el.textContent = this.data.points;
                });
                document.querySelectorAll('#visit-streak').forEach(el => {
                    el.textContent = this.data.streak;
                });
            }
        }

        // Add screen flash animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes screenFlash {
                0% { opacity: 0; }
                50% { opacity: 1; }
                100% { opacity: 0; }
            }
            .deal-value {
                font-size: 0.8rem;
                color: #4ade80;
                margin-top: 0.5rem;
                font-weight: 600;
            }
        `;
        document.head.appendChild(style);

        // King Wash pamphlet scroll sparkle effect
        let scrollSparkleTimeout;
        
        function triggerScrollSparkle() {
            const pamphlet = document.querySelector('.king-wash-pamphlet');
            if (pamphlet) {
                pamphlet.classList.add('scroll-sparkle');
                clearTimeout(scrollSparkleTimeout);
                scrollSparkleTimeout = setTimeout(() => {
                    pamphlet.classList.remove('scroll-sparkle');
                }, 2000);
            }
        }
        
        // Throttled scroll listener for sparkle effect
        let scrollTimer;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollTimer);
            scrollTimer = setTimeout(triggerScrollSparkle, 100);
        });
        
        // Arcade Gallery functionality
        class ArcadeGallery {
            constructor() {
                this.arcadePhotos = [
                    {
                        image: "img/arcade-photo.png",
                        title: "Main Arcade Floor",
                        description: "The heart of our retro gaming paradise"
                    },
                    {
                        image: "img/arcade-photo-2.png",
                        title: "Gaming Zone",
                        description: "Where the magic happens"
                    },
                    {
                        image: "img/arcade-photo-office.png",
                        title: "Development Office",
                        description: "Behind the scenes workspace"
                    },
                    {
                        image: "img/arcade-storage-area.png",
                        title: "Storage Area",
                        description: "Keeping everything organized"
                    },
                    {
                        image: "img/arcade-entrance.png",
                        title: "Arcade Entrance",
                        description: "Welcome to the gaming dimension"
                    },
                    {
                        image: "img/arcade-entrance-1.png",
                        title: "Entrance Detail",
                        description: "Step into the neon-lit gaming world"
                    }
                ];
                
                this.init();
            }
            
            init() {
                this.populateGallery();
            }
            
            populateGallery() {
                const container = document.getElementById('arcade-photos');
                if (!container) return;
                
                // Shuffle and select 3 random photos
                const shuffled = [...this.arcadePhotos].sort(() => 0.5 - Math.random());
                const selectedPhotos = shuffled.slice(0, 3);
                
                // Clear container
                container.innerHTML = '';
                
                // Create photo cards
                selectedPhotos.forEach(photo => {
                    const photoCard = this.createPhotoCard(photo);
                    container.appendChild(photoCard);
                });
            }
            
            createPhotoCard(photo) {
                const card = document.createElement('div');
                card.className = 'arcade-photo-card';
                
                card.innerHTML = `
                    <img src="${photo.image}" alt="${photo.title}">
                    <div class="photo-overlay">
                        <h3>${photo.title}</h3>
                        <p>${photo.description}</p>
                    </div>
                `;
                
                return card;
            }
        }

        // Initialize carousel, featured cabinet, arcade gallery, and loyalty system when page loads
        window.addEventListener('load', () => {
            new ArcadeCarousel();
            new FeaturedCabinet();
            new ArcadeGallery();
            new LoyaltySystem();
        });
    </script>
</body>
</html>
