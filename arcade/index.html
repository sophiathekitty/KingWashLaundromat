<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Paradise - King Wash</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <div class="header-content">
            <!-- King Wash Pamphlet integrated into header - left side -->
            <div class="king-wash-container">
                <div class="king-wash-pamphlet">
                    <a href="../index.html" class="king-wash-card">
                        <div class="pamphlet-content">
                            <div class="pamphlet-header">
                                <img src="../img/logo-gold.png" alt="King Wash Logo" class="pamphlet-logo">
                                <h3>King Wash</h3>
                                <div class="luxury-accent"></div>
                            </div>
                            <div class="pamphlet-body">
                                <p class="tagline">Premium Laundromat</p>
                                <p class="description">Clean clothes, classic games</p>
                                <div class="luxury-border"></div>
                            </div>
                            <div class="pamphlet-footer">
                                <span class="cta">Visit Now ‚Üí</span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
            
            <div class="header-text">
                <h1>Arcade Paradise</h1>
                <p>What started as a simple laundromat has grown into a thriving retro arcade, thanks to our new manager's passion for game development! Step into the backroom and discover original creations alongside some incredible cabinets from other talented builders. Play hard, fold fast!</p>
            </div>
        </div>
    </header>

    <!-- Featured Cabinet & Promotions -->
    <section class="featured-section">
        <div class="featured-cabinet">
            <h2>Featured Cabinet</h2>
            <div class="featured-card" id="featured-card">
                <img src="img/woodgal-jr.png" alt="Featured Game" id="featured-image">
                <div class="featured-info">
                    <h3 id="featured-title">Woodgal Jr.</h3>
                    <p id="featured-description">A fast-paced tree-chopping game. Swap sides to avoid branches!</p>
                    <button class="featured-button" id="featured-button" onclick="openSteam('https://steamcommunity.com/sharedfiles/filedetails/?id=3142471782')">
                        Play Now
                    </button>
                </div>
            </div>
        </div>
        <div class="promotions">
            <h2>King Wash Loyalty Rewards</h2>
            
            <!-- Loyalty Points Display -->
            <div class="loyalty-display">
                <div class="points-counter">
                    <span class="points-icon">‚≠ê</span>
                    <span class="points-value" id="loyalty-points">0</span>
                    <span class="points-label">Loyalty Points</span>
                </div>
                <div class="streak-counter">
                    <span class="streak-icon">üî•</span>
                    <span class="streak-value" id="visit-streak">0</span>
                    <span class="streak-label">Day Streak</span>
                </div>
            </div>
            
            <!-- Welcome Bonus -->
            <div class="promo-card welcome-bonus" id="welcome-bonus" data-points="100">
                <h3>üéâ Welcome Bonus!</h3>
                <p>First time at King Wash? Claim your welcome reward!</p>
                <div class="promo-reward">+100 LP</div>
                <div class="promo-badge claimable">Claim Now</div>
            </div>
            
            <!-- Daily Check-in -->
            <div class="promo-card daily-checkin" id="daily-checkin" data-points="50">
                <h3>üìÖ Daily Check-in</h3>
                <p>Visit us every day to build your streak and earn bonus points!</p>
                <div class="promo-reward">+50 LP</div>
                <div class="promo-badge claimable">Check In</div>
            </div>
            
            <!-- Dynamic Deals Container -->
            <div id="daily-deals-container">
                <!-- Deals will be generated by JavaScript -->
            </div>
            
            <!-- Yesterday's Unclaimed Rewards -->
            <div id="yesterday-rewards" style="display: none;">
                <h3>‚è∞ Yesterday's Unclaimed Rewards</h3>
                <div id="yesterday-deals-container">
                    <!-- Yesterday's deals will appear here -->
                </div>
            </div>
        </div>
    </section>

    <section>
        <h2>Custom Arcade Cabinets</h2>
        <p>These one-of-a-kind games were designed and built in-house! Click a cabinet to learn more or download it from the Steam Workshop.</p>
        
        <div class="carousel-container">
            <button class="carousel-btn carousel-btn-prev" id="carousel-prev">‚Äπ</button>
            <div class="carousel-wrapper">
                <div class="arcade-carousel" id="arcade-carousel">
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3142471782">
                        <img src="img/woodgal-jr.png" alt="Woodgal Jr.">
                        <h3>Woodgal Jr.</h3>
                        <p>A fast-paced tree-chopping game. Swap sides to avoid branches!</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3142472800">
                        <img src="img/dance-engineer-dance.png" alt="Dance Engineer Dance">
                        <h3>Dance Engineer Dance</h3>
                        <p>Test your rhythm in this DDR-inspired cabinet!</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3142474001">
                        <img src="img/air-hockey.png" alt="Air Hockey">
                        <h3>Air Hockey</h3>
                        <p>Classic air hockey fun, now digital!</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3159105570">
                        <img src="img/flappy-bird.png" alt="Flappy Bird">
                        <h3>Flappy Bird</h3>
                        <p>Flap your way through obstacles in this challenging remake.</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3159106410">
                        <img src="img/space-invaders.png" alt="Space Invaders">
                        <h3>Space Invaders</h3>
                        <p>Defend Earth in this tribute to the arcade classic.</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3159107075">
                        <img src="img/breakout.png" alt="Breakout">
                        <h3>Breakout</h3>
                        <p>Smash bricks and score big in this timeless game.</p>
                    </div>
                    <div class="arcade-card" data-steam-url="https://steamcommunity.com/sharedfiles/filedetails/?id=3173071227">
                        <img src="img/wolf-3d.png" alt="Wolf 3D">
                        <h3>Wolf 3D</h3>
                        <p>A retro 3D shooter. It's like Wolfenstein but voxelized!</p>
                    </div>
                </div>
            </div>
            <button class="carousel-btn carousel-btn-next" id="carousel-next">‚Ä∫</button>
        </div>
    </section>

    <section>
        <div class="community-section-card">
            <h2>Community Arcade Cabinets</h2>
            <div class="community-content">
                <p>We're proud to showcase some incredible cabinets from the Steam Workshop that helped inspire our designs. These creations are a testament to the creativity of the Space Engineers community!</p>
        <div class="arcade-gallery">
            <div class="arcade-group" data-creator="kelevra">
                <div class="community-image" style="background-image: url('img/kelevra-tetris-snake.png')"></div>
                <h3>Kelevra</h3>
                <p>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2883502340" target="_blank" data-cabinet="tetris">Tetris</a> | 
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2906631630" target="_blank" data-cabinet="snake">Snake</a>
                </p>
            </div>
            <div class="arcade-group" data-creator="jasba">
                <div class="community-image" style="background-image: url('img/jasba-titan-flug.png')"></div>
                <h3>Jasba</h3>
                <p><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3048874542" target="_blank" data-cabinet="titan-flug">Titan Flug</a></p>
            </div>
            <div class="arcade-group" data-creator="avaness">
                <div class="community-image" style="background-image: url('img/avaness-cabinets.png')"></div>
                <h3>Avaness</h3>
                <p>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2432952109" target="_blank" data-cabinet="tron">Tron</a> | 
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2432951311" target="_blank" data-cabinet="avaness-snake">Snake</a> | 
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2432950269" target="_blank" data-cabinet="pong">Pong</a>
                </p>
            </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <p>&copy; 2077 Arcade Paradise. Powered by <span class="glitch-text" id="company-name">Grindstone Enterprises</span>.</p>
    </footer>

    <script>
        // Arcade cabinet data
        const arcadeCabinets = [
            {
                title: "Woodgal Jr.",
                description: "A fast-paced tree-chopping game. Swap sides to avoid branches!",
                image: "img/woodgal-jr.png",
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3142471782"
            },
            {
                title: "Dance Engineer Dance",
                description: "Test your rhythm in this DDR-inspired cabinet!",
                image: "img/dance-engineer-dance.png",
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3142472800"
            },
            {
                title: "Air Hockey",
                description: "Classic air hockey fun, now digital!",
                image: "img/air-hockey.png",
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3142474001"
            },
            {
                title: "Flappy Bird",
                description: "Flap your way through obstacles in this challenging remake.",
                image: "img/flappy-bird.png",
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3159105570"
            },
            {
                title: "Space Invaders",
                description: "Defend Earth in this tribute to the arcade classic.",
                image: "img/space-invaders.png",
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3159106410"
            },
            {
                title: "Breakout",
                description: "Smash bricks and score big in this timeless game.",
                image: "img/breakout.png",
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3159107075"
            },
            {
                title: "Wolf 3D",
                description: "A retro 3D shooter. It's like Wolfenstein but voxelized!",
                image: "img/wolf-3d.png",
                steamUrl: "https://steamcommunity.com/sharedfiles/filedetails/?id=3173071227"
            }
        ];

        // Carousel functionality
        class ArcadeCarousel {
            constructor() {
                this.carousel = document.getElementById('arcade-carousel');
                this.prevBtn = document.getElementById('carousel-prev');
                this.nextBtn = document.getElementById('carousel-next');
                this.originalCards = Array.from(this.carousel.querySelectorAll('.arcade-card'));
                this.currentIndex = 0;
                this.visibleCards = this.getVisibleCards();
                this.isAutoScrolling = true;
                this.autoScrollInterval = null;
                this.userInteractionTimeout = null;
                this.isTransitioning = false;
                
                this.init();
            }
            
            getVisibleCards() {
                const width = window.innerWidth;
                if (width <= 480) return 1;
                if (width <= 768) return 2;
                if (width <= 1024) return 3;
                if (width <= 1440) return 4;
                return 5;
            }
            
            init() {
                this.setupInfiniteScroll();
                this.setupEventListeners();
                this.updateCarousel();
                this.startAutoScroll();
                
                // Add click handlers to cards
                this.updateClickHandlers();
            }
            
            setupInfiniteScroll() {
                // Clear existing cards
                this.carousel.innerHTML = '';
                
                // Create enough clones for smooth infinite scrolling
                const totalNeeded = this.originalCards.length * 3; // Show original + clones before and after
                
                // Add clones before original
                for (let i = 0; i < this.originalCards.length; i++) {
                    const clone = this.originalCards[i].cloneNode(true);
                    clone.classList.add('carousel-clone');
                    this.carousel.appendChild(clone);
                }
                
                // Add original cards
                this.originalCards.forEach(card => {
                    this.carousel.appendChild(card);
                });
                
                // Add clones after original
                for (let i = 0; i < this.originalCards.length; i++) {
                    const clone = this.originalCards[i].cloneNode(true);
                    clone.classList.add('carousel-clone');
                    this.carousel.appendChild(clone);
                }
                
                // Update cards reference
                this.cards = Array.from(this.carousel.querySelectorAll('.arcade-card'));
                
                // Set initial position to show original cards
                this.currentIndex = this.originalCards.length;
                this.carousel.style.transition = 'none';
                this.updateCarousel();
                
                // Re-enable transitions after initial positioning
                setTimeout(() => {
                    this.carousel.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                }, 50);
            }
            
            updateClickHandlers() {
                this.cards.forEach(card => {
                    card.addEventListener('click', () => {
                        const steamUrl = card.getAttribute('data-steam-url');
                        if (steamUrl) {
                            window.open(steamUrl, '_blank');
                        }
                    });
                });
            }
            
            setupEventListeners() {
                this.prevBtn.addEventListener('click', () => this.prevSlide());
                this.nextBtn.addEventListener('click', () => this.nextSlide());
                
                // Touch/drag support
                let startX = 0;
                let isDragging = false;
                
                this.carousel.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    isDragging = true;
                    this.handleUserInteraction();
                });
                
                this.carousel.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                });
                
                this.carousel.addEventListener('touchend', (e) => {
                    if (!isDragging) return;
                    isDragging = false;
                    
                    const endX = e.changedTouches[0].clientX;
                    const diffX = startX - endX;
                    
                    if (Math.abs(diffX) > 50) {
                        if (diffX > 0) {
                            this.nextSlide();
                        } else {
                            this.prevSlide();
                        }
                    }
                });
                
                // Mouse events
                this.carousel.addEventListener('mouseenter', () => this.handleUserInteraction());
                this.carousel.addEventListener('mouseleave', () => this.resumeAutoScroll());
                
                // Resize handler
                window.addEventListener('resize', () => {
                    this.visibleCards = this.getVisibleCards();
                    this.setupInfiniteScroll();
                });
            }
            
            nextSlide() {
                if (this.isTransitioning) return;
                this.isTransitioning = true;
                
                this.currentIndex++;
                this.updateCarousel();
                this.handleUserInteraction();
                
                // Check if we need to reset position (infinite scroll)
                if (this.currentIndex >= this.originalCards.length * 2) {
                    setTimeout(() => {
                        this.carousel.style.transition = 'none';
                        this.currentIndex = this.originalCards.length;
                        this.updateCarousel();
                        setTimeout(() => {
                            this.carousel.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                            this.isTransitioning = false;
                        }, 50);
                    }, 500);
                } else {
                    setTimeout(() => {
                        this.isTransitioning = false;
                    }, 500);
                }
            }
            
            prevSlide() {
                if (this.isTransitioning) return;
                this.isTransitioning = true;
                
                this.currentIndex--;
                this.updateCarousel();
                this.handleUserInteraction();
                
                // Check if we need to reset position (infinite scroll)
                if (this.currentIndex < 0) {
                    setTimeout(() => {
                        this.carousel.style.transition = 'none';
                        this.currentIndex = this.originalCards.length - 1;
                        this.updateCarousel();
                        setTimeout(() => {
                            this.carousel.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                            this.isTransitioning = false;
                        }, 50);
                    }, 500);
                } else {
                    setTimeout(() => {
                        this.isTransitioning = false;
                    }, 500);
                }
            }
            
            updateCarousel() {
                if (this.cards.length === 0) return;
                const cardWidth = this.cards[0].offsetWidth + 24; // Include gap
                const offset = -this.currentIndex * cardWidth;
                this.carousel.style.transform = `translateX(${offset}px)`;
            }
            
            handleUserInteraction() {
                this.isAutoScrolling = false;
                clearInterval(this.autoScrollInterval);
                clearTimeout(this.userInteractionTimeout);
                
                this.userInteractionTimeout = setTimeout(() => {
                    this.resumeAutoScroll();
                }, 5000);
            }
            
            resumeAutoScroll() {
                clearTimeout(this.userInteractionTimeout);
                this.startAutoScroll();
            }
            
            startAutoScroll() {
                this.isAutoScrolling = true;
                this.autoScrollInterval = setInterval(() => {
                    if (this.isAutoScrolling) {
                        this.nextSlide();
                    }
                }, 3000);
            }
        }

        // Featured cabinet functionality
        class FeaturedCabinet {
            constructor() {
                this.currentIndex = Math.floor(Math.random() * arcadeCabinets.length);
                this.rotationInterval = null;
                this.isUserActive = true;
                this.inactivityTimeout = null;
                
                this.init();
            }
            
            init() {
                this.updateFeaturedCabinet();
                this.startInactivityTimer();
                
                // Track user activity
                document.addEventListener('mousemove', () => this.handleUserActivity());
                document.addEventListener('keydown', () => this.handleUserActivity());
                document.addEventListener('scroll', () => this.handleUserActivity());
                document.addEventListener('touchstart', () => this.handleUserActivity());
            }
            
            updateFeaturedCabinet() {
                const cabinet = arcadeCabinets[this.currentIndex];
                
                document.getElementById('featured-image').src = cabinet.image;
                document.getElementById('featured-title').textContent = cabinet.title;
                document.getElementById('featured-description').textContent = cabinet.description;
                document.getElementById('featured-button').onclick = () => openSteam(cabinet.steamUrl);
            }
            
            rotateFeatured() {
                this.currentIndex = (this.currentIndex + 1) % arcadeCabinets.length;
                this.updateFeaturedCabinet();
            }
            
            handleUserActivity() {
                this.isUserActive = true;
                clearTimeout(this.inactivityTimeout);
                clearInterval(this.rotationInterval);
                this.startInactivityTimer();
            }
            
            startInactivityTimer() {
                this.inactivityTimeout = setTimeout(() => {
                    this.isUserActive = false;
                    this.startRotation();
                }, 30000); // 30 seconds of inactivity
            }
            
            startRotation() {
                if (!this.isUserActive) {
                    this.rotationInterval = setInterval(() => {
                        if (!this.isUserActive) {
                            this.rotateFeatured();
                        }
                    }, 10000); // Rotate every 10 seconds when inactive
                }
            }
        }

        // Auto-cycling gallery animation (for community section)
        let isUserInteracting = false;
        let cycleTimeout;
        
        function startAutoCycle() {
            if (!isUserInteracting) {
                const galleries = document.querySelectorAll('.arcade-gallery');
                galleries.forEach(gallery => {
                    gallery.classList.add('auto-cycle');
                });
            }
        }
        
        function stopAutoCycle() {
            const galleries = document.querySelectorAll('.arcade-gallery');
            galleries.forEach(gallery => {
                gallery.classList.remove('auto-cycle');
            });
        }
        
        // Stop auto-cycle when user interacts
        function handleUserInteraction() {
            isUserInteracting = true;
            stopAutoCycle();
            clearTimeout(cycleTimeout);
            
            // Resume auto-cycle after 10 seconds of no interaction
            cycleTimeout = setTimeout(() => {
                isUserInteracting = false;
                startAutoCycle();
            }, 10000);
        }
        
        // Event listeners for user interaction
        document.addEventListener('scroll', handleUserInteraction);
        document.addEventListener('mousemove', handleUserInteraction);
        document.addEventListener('touchstart', handleUserInteraction);
        
        // Add hover events to arcade cards (including community cards)
        document.querySelectorAll('.arcade-card, .arcade-group').forEach(card => {
            card.addEventListener('mouseenter', handleUserInteraction);
        });
        
        // Community card zoom effects
        document.querySelectorAll('.arcade-group a[data-cabinet]').forEach(link => {
            const parentGroup = link.closest('.arcade-group');
            const cabinetType = link.getAttribute('data-cabinet');
            
            link.addEventListener('mouseenter', function() {
                parentGroup.classList.add(`zoom-${cabinetType}`, 'zooming');
                handleUserInteraction();
            });
            
            link.addEventListener('mouseleave', function() {
                parentGroup.classList.remove(`zoom-${cabinetType}`, 'zooming');
            });
        });
        
        // Start auto-cycle when page loads
        window.addEventListener('load', () => {
            setTimeout(startAutoCycle, 2000);
        });
        
        // Glitch effect for company name
        const companyName = document.getElementById('company-name');
        let isGlitched = false;
        
        companyName.addEventListener('mouseenter', function() {
            if (!isGlitched) {
                this.classList.add('glitching');
                
                setTimeout(() => {
                    this.textContent = 'Null Systems';
                    this.style.color = '#ff00d9';
                    this.classList.remove('glitching');
                    isGlitched = true;
                    
                    // Make it a link
                    const link = document.createElement('a');
                    link.href = 'https://sophiathekitty.github.io/GridDB/index.html';
                    link.target = '_blank';
                    link.className = 'glitch-text';
                    link.style.color = '#ff00d9';
                    link.style.textDecoration = 'none';
                    link.textContent = 'Null Systems';
                    
                    this.parentNode.replaceChild(link, this);
                }, 500);
            }
        });
        
        companyName.addEventListener('touchstart', function() {
            // Same functionality for mobile
            if (!isGlitched) {
                this.classList.add('glitching');
                
                setTimeout(() => {
                    this.textContent = 'Null Systems';
                    this.style.color = '#ff00d9';
                    this.classList.remove('glitching');
                    isGlitched = true;
                    
                    const link = document.createElement('a');
                    link.href = 'https://sophiathekitty.github.io/GridDB/index.html';
                    link.target = '_blank';
                    link.className = 'glitch-text';
                    link.style.color = '#ff00d9';
                    link.style.textDecoration = 'none';
                    link.textContent = 'Null Systems';
                    
                    this.parentNode.replaceChild(link, this);
                }, 500);
            }
        });

        function openSteam(url) {
            window.open(url, '_blank');
        }

        // Loyalty Points System
        class LoyaltySystem {
            constructor() {
                this.storageKey = 'kingwash_loyalty';
                this.data = this.loadData();
                this.dailyDeals = [
                    {id: 'arcade_combo', title: 'üéÆ Arcade + Laundry Combo', desc: 'Play 3 games while washing', reward: 75, price: '15% off laundry (Save ~45 SC)'},
                    {id: 'high_score', title: 'üèÜ High Score Challenge', desc: 'Beat today\'s high score on any cabinet', reward: 100, price: 'Free soap tokens (Worth 25 SC)'},
                    {id: 'social_share', title: 'üì± Share the Fun', desc: 'Tell a friend about King Wash Arcade', reward: 50, price: 'Word-of-mouth bonus'},
                    {id: 'wash_cycle', title: 'üåÄ Full Service Wash', desc: 'Use wash, dry, and fold services', reward: 120, price: 'Premium service discount (Save ~80 SC)'},
                    {id: 'loyalty_member', title: '‚≠ê VIP Treatment', desc: 'Spend over 500 SC in one visit', reward: 200, price: 'Big spender bonus'},
                    {id: 'early_bird', title: 'üåÖ Early Bird Special', desc: 'Visit before 9 AM', reward: 60, price: 'Off-peak pricing (Save ~30 SC)'},
                    {id: 'night_owl', title: 'ü¶â Night Owl Bonus', desc: 'Visit after 10 PM', reward: 80, price: 'Late night discount (Save ~40 SC)'},
                    {id: 'weekend_warrior', title: 'üéØ Weekend Warrior', desc: 'Complete 5 arcade challenges', reward: 150, price: 'Weekend entertainment package'}
                ];
                
                this.init();
            }
            
            loadData() {
                const saved = localStorage.getItem(this.storageKey);
                if (saved) {
                    return JSON.parse(saved);
                }
                return {
                    points: 0,
                    streak: 0,
                    lastVisit: null,
                    welcomeClaimed: false,
                    todaysClaims: {},
                    yesterdaysClaims: {},
                    dailyDealsGenerated: null
                };
            }
            
            saveData() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.data));
            }
            
            init() {
                this.updateDisplay();
                this.checkDailyReset();
                this.generateDailyDeals();
                this.setupEventListeners();
                this.checkYesterdayRewards();
            }
            
            checkDailyReset() {
                const today = new Date().toDateString();
                const lastVisit = this.data.lastVisit;
                
                if (lastVisit !== today) {
                    // Move today's claims to yesterday's
                    this.data.yesterdaysClaims = {...this.data.todaysClaims};
                    this.data.todaysClaims = {};
                    
                    // Update streak
                    if (lastVisit) {
                        const lastDate = new Date(lastVisit);
                        const todayDate = new Date(today);
                        const diffTime = Math.abs(todayDate - lastDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        if (diffDays === 1) {
                            this.data.streak += 1;
                        } else if (diffDays > 1) {
                            this.data.streak = 1;
                        }
                    } else {
                        this.data.streak = 1;
                    }
                    
                    this.data.lastVisit = today;
                    this.data.dailyDealsGenerated = null;
                    this.saveData();
                }
            }
            
            generateDailyDeals() {
                const today = new Date().toDateString();
                if (this.data.dailyDealsGenerated !== today) {
                    // Generate 3-4 random deals for today
                    const numDeals = 3 + Math.floor(Math.random() * 2);
                    const shuffled = [...this.dailyDeals].sort(() => 0.5 - Math.random());
                    this.todaysDeals = shuffled.slice(0, numDeals);
                    this.data.dailyDealsGenerated = today;
                    this.saveData();
                } else {
                    // Use the same deals as generated earlier today
                    const seed = this.hashCode(today);
                    const numDeals = 3 + (seed % 2);
                    this.todaysDeals = this.seededShuffle([...this.dailyDeals], seed).slice(0, numDeals);
                }
                
                this.renderDailyDeals();
            }
            
            hashCode(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash);
            }
            
            seededShuffle(array, seed) {
                const rng = () => {
                    seed = seed * 9301 + 49297;
                    return (seed % 233280) / 233280;
                };
                
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(rng() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            renderDailyDeals() {
                const container = document.getElementById('daily-deals-container');
                container.innerHTML = '<h3>üé≤ Today\'s Special Deals</h3>';
                
                this.todaysDeals.forEach(deal => {
                    const claimed = this.data.todaysClaims[deal.id];
                    const card = document.createElement('div');
                    card.className = `promo-card daily-deal ${claimed ? 'claimed' : ''}`;
                    card.dataset.dealId = deal.id;
                    card.dataset.points = deal.reward;
                    
                    card.innerHTML = `
                        <h3>${deal.title}</h3>
                        <p>${deal.desc}</p>
                        <div class="promo-reward">+${deal.reward} LP</div>
                        <div class="deal-value">üí∞ ${deal.price}</div>
                        <div class="promo-badge ${claimed ? 'claimed' : 'claimable'}">${claimed ? 'Claimed' : 'Claim'}</div>
                    `;
                    
                    container.appendChild(card);
                });
            }
            
            checkYesterdayRewards() {
                const yesterdayContainer = document.getElementById('yesterday-rewards');
                const yesterdayDealsContainer = document.getElementById('yesterday-deals-container');
                
                if (Object.keys(this.data.yesterdaysClaims).length > 0) {
                    yesterdayContainer.style.display = 'block';
                    yesterdayDealsContainer.innerHTML = '';
                    
                    Object.entries(this.data.yesterdaysClaims).forEach(([dealId, claimed]) => {
                        const deal = this.dailyDeals.find(d => d.id === dealId);
                        if (deal && claimed) {
                            const card = document.createElement('div');
                            card.className = 'promo-card yesterday-bonus';
                            card.dataset.dealId = dealId;
                            card.dataset.points = Math.floor(deal.reward * 0.5);
                            
                            card.innerHTML = `
                                <h3>‚è∞ ${deal.title} - Completion Bonus</h3>
                                <p>Extra points for completing yesterday's challenge!</p>
                                <div class="promo-reward">+${Math.floor(deal.reward * 0.5)} LP</div>
                                <div class="promo-badge claimable">Collect Bonus</div>
                            `;
                            
                            yesterdayDealsContainer.appendChild(card);
                        }
                    });
                }
            }
            
            setupEventListeners() {
                // Welcome bonus
                const welcomeBonus = document.getElementById('welcome-bonus');
                if (!this.data.welcomeClaimed) {
                    welcomeBonus.addEventListener('click', () => this.claimReward(welcomeBonus, 'welcome'));
                } else {
                    welcomeBonus.classList.add('claimed');
                    welcomeBonus.querySelector('.promo-badge').textContent = 'Claimed';
                    welcomeBonus.querySelector('.promo-badge').className = 'promo-badge claimed';
                }
                
                // Daily check-in
                const dailyCheckin = document.getElementById('daily-checkin');
                if (!this.data.todaysClaims['daily_checkin']) {
                    dailyCheckin.addEventListener('click', () => this.claimReward(dailyCheckin, 'daily_checkin'));
                } else {
                    dailyCheckin.classList.add('claimed');
                    dailyCheckin.querySelector('.promo-badge').textContent = 'Checked In';
                    dailyCheckin.querySelector('.promo-badge').className = 'promo-badge claimed';
                }
                
                // Daily deals (delegated event listener)
                document.addEventListener('click', (e) => {
                    const card = e.target.closest('.daily-deal, .yesterday-bonus');
                    if (card && !card.classList.contains('claimed')) {
                        this.claimDeal(card);
                    }
                });
            }
            
            claimReward(element, type) {
                if (element.classList.contains('claimed')) return;
                
                const points = parseInt(element.dataset.points);
                this.addPoints(points, element);
                
                if (type === 'welcome') {
                    this.data.welcomeClaimed = true;
                } else if (type === 'daily_checkin') {
                    this.data.todaysClaims['daily_checkin'] = true;
                }
                
                element.classList.add('claimed');
                element.querySelector('.promo-badge').textContent = 'Claimed';
                element.querySelector('.promo-badge').className = 'promo-badge claimed';
                
                this.saveData();
            }
            
            claimDeal(element) {
                const dealId = element.dataset.dealId;
                const points = parseInt(element.dataset.points);
                
                this.addPoints(points, element);
                
                if (element.classList.contains('yesterday-bonus')) {
                    // Remove from yesterday's claims after collecting bonus
                    delete this.data.yesterdaysClaims[dealId];
                    element.remove();
                    
                    // Hide yesterday section if empty
                    if (Object.keys(this.data.yesterdaysClaims).length === 0) {
                        document.getElementById('yesterday-rewards').style.display = 'none';
                    }
                } else {
                    this.data.todaysClaims[dealId] = true;
                    element.classList.add('claimed');
                    element.querySelector('.promo-badge').textContent = 'Claimed';
                    element.querySelector('.promo-badge').className = 'promo-badge claimed';
                }
                
                this.saveData();
            }
            
            addPoints(amount, element) {
                this.data.points += amount;
                this.updateDisplay();
                this.createArcadeEffects(element, amount);
            }
            
            createArcadeEffects(element, points) {
                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                // Create laser effects
                for (let i = 0; i < 6; i++) {
                    setTimeout(() => {
                        this.createLaser(centerX + (Math.random() - 0.5) * 200, centerY);
                    }, i * 100);
                }
                
                // Create explosion effect
                setTimeout(() => {
                    this.createExplosion(centerX, centerY);
                    this.createPointsPopup(centerX, centerY, points);
                }, 300);
                
                // Screen flash effect
                this.createScreenFlash();
            }
            
            createLaser(x, y) {
                const laser = document.createElement('div');
                laser.className = 'laser-effect';
                laser.style.left = x + 'px';
                laser.style.top = y + 'px';
                laser.style.animation = 'laserShoot 0.5s ease-out forwards';
                document.body.appendChild(laser);
                
                setTimeout(() => laser.remove(), 500);
            }
            
            createExplosion(x, y) {
                const explosion = document.createElement('div');
                explosion.className = 'explosion-effect';
                explosion.style.left = (x - 50) + 'px';
                explosion.style.top = (y - 50) + 'px';
                explosion.style.background = `
                    radial-gradient(circle, transparent 20%, var(--neon-pink) 25%, transparent 30%),
                    radial-gradient(circle, transparent 40%, var(--neon-cyan) 45%, transparent 50%),
                    conic-gradient(from 0deg, var(--neon-pink), var(--neon-cyan), var(--neon-pink))
                `;
                explosion.style.animation = 'neonExplode 1s ease-out forwards';
                document.body.appendChild(explosion);
                
                setTimeout(() => explosion.remove(), 1000);
            }
            
            createPointsPopup(x, y, points) {
                const popup = document.createElement('div');
                popup.className = 'points-popup';
                popup.textContent = `+${points} LP`;
                popup.style.left = (x - 30) + 'px';
                popup.style.top = (y - 20) + 'px';
                document.body.appendChild(popup);
                
                setTimeout(() => popup.remove(), 2000);
            }
            
            createScreenFlash() {
                const flash = document.createElement('div');
                flash.style.position = 'fixed';
                flash.style.top = '0';
                flash.style.left = '0';
                flash.style.width = '100vw';
                flash.style.height = '100vh';
                flash.style.background = 'rgba(0, 255, 255, 0.1)';
                flash.style.pointerEvents = 'none';
                flash.style.zIndex = '9999';
                flash.style.animation = 'screenFlash 0.3s ease-out';
                document.body.appendChild(flash);
                
                setTimeout(() => flash.remove(), 300);
            }
            
            updateDisplay() {
                document.getElementById('loyalty-points').textContent = this.data.points;
                document.getElementById('visit-streak').textContent = this.data.streak;
            }
        }

        // Add screen flash animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes screenFlash {
                0% { opacity: 0; }
                50% { opacity: 1; }
                100% { opacity: 0; }
            }
            .deal-value {
                font-size: 0.8rem;
                color: #4ade80;
                margin-top: 0.5rem;
                font-weight: 600;
            }
        `;
        document.head.appendChild(style);

        // King Wash pamphlet scroll sparkle effect
        let scrollSparkleTimeout;
        
        function triggerScrollSparkle() {
            const pamphlet = document.querySelector('.king-wash-pamphlet');
            if (pamphlet) {
                pamphlet.classList.add('scroll-sparkle');
                clearTimeout(scrollSparkleTimeout);
                scrollSparkleTimeout = setTimeout(() => {
                    pamphlet.classList.remove('scroll-sparkle');
                }, 2000);
            }
        }
        
        // Throttled scroll listener for sparkle effect
        let scrollTimer;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollTimer);
            scrollTimer = setTimeout(triggerScrollSparkle, 100);
        });
        
        // Initialize carousel, featured cabinet, and loyalty system when page loads
        window.addEventListener('load', () => {
            new ArcadeCarousel();
            new FeaturedCabinet();
            new LoyaltySystem();
        });
    </script>
</body>
</html>
